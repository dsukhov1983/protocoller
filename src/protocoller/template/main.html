{% extends "base.html" %}
{% load pytils_dt %}
{% load pretty_print %}
{% load thumbnail %}
{% block content %}
<div class="grid_6">
  <h1>Прошедшие</h1>
  {% for year, comp_groups in past_groups %}
  {% if year != today.year %}
  <h1>{{ year }}</h1>
  {% endif %}
  {% for date, events in comp_groups %}
  <div class="event_group">
    <h3>{{ date|ru_strftime:"%d %b %a" }}</h3>
    {% for event in events %}
    <div class="event">
      {% if event.image %}
      {% thumbnail event.image "75" as im %}
      <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" class="float: left"/>
      {% endthumbnail %}
      {% endif %}
      <h4 class="place">{{ event.place|default:"" }}</h4>
      <h5><a href="{% url event event.id %}">{{ event.name }}</a></h5>
      <div class="comps">
        {% for comp in event.competitions.all %}
        {% if forloop.first %}<div class="grid_1 alpha comp">
        {% else %}
        {% if forloop.last %}<div class="grid_1 omega comp">
        {% else %}
        <div class="grid_1 comp">
          {% endif %}
          {% endif %}
          {% if comp.processed %}
          <a href="{% url protocol comp.id %}">{{ comp }}</a>
          {% else %}
          <span>{{ comp }}</span>
          {% endif %}
        </div>  
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
  {% endfor %}
  <div class="pager">
    {% if past_page.has_next %}
    <a href="{% url past_events %}?page=2&per_page={{ per_page }}">Предыдущие</a>
    {% endif %}
  </div>
</div>
<div class="grid_6">
  <h1>Предстоящие</h1><a href="{% url add_event %}">Создать соревнование</a>
  {% for year, comp_groups in coming_groups %}
  {% if year != today.year %}
  <h1>{{ year }}</h1>
  {% endif %}
  {% for date, events in comp_groups %}
  <div class="event_group">
    <h3 class="date">{{ date|ru_strftime:"%d %b  %a" }}</h3>
    {% for event in events %}
    <div class="event">
      {% if event.image %}
      {% thumbnail event.image "75" as im %}
      <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"/>
      {% endthumbnail %}
      {% endif %}
      <h4 class="place">{{ event.place|default:"" }}</h4>
      <h5><a href="{% url event event.id %}">{{ event.name }}</a></h5>
      <div class="comps">
        {% for comp in event.competitions.all %}
        {% if forloop.first %}<div class="grid_1 alpha comp">
        {% else %}
        {% if forloop.last %}<div class="grid_1 omega comp">
        {% else %}
        <div class="grid_1 comp">
          {% endif %}
          {% endif %}
          {% if comp.processed %}
          <a href="{% url protocol comp.id %}">{{ comp }}</a>
          {% else %}
          <span>{{ comp }}</span>
          {% endif %}
        </div>  
        {% endfor %}
        </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
  {% endfor %}
  <div class="pager">
    {% if coming_page.has_next %}
    <a href="{% url future_events %}?page=2&per_page={{ per_page }}">Следующие</a>
    {% endif %}
  </div>
</div>
{% endblock %}
