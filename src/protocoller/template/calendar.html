{% extends "base.html" %}
{% load i18n %}
{% load pytils_dt %}
{% load pretty_print %}
{% load markup %}
{% load pytils_numeral %}
{% load thumbnail %}
{% load gencal %}
{% load comments %}

{% block extrahead %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.ias.js"></script>
<script type="text/javascript">
jQuery.ias({
  container     : ".event_list",
        // Enter the selector of the element containing
        // your items that you want to paginate.

  item      : ".month_events",
        // Enter the selector of the element that each
        // item has. Make sure the elements are inside
        // the container element.

  pagination    : "#content .navigation",
        // Enter the selector of the element that contains
        // your regular pagination links, like next,
        // previous and the page numbers. This element
        // will be hidden when IAS loads.

  next      : ".next-events a",
        // Enter the selector of the link element that
        // links to the next page. The href attribute
        // of this element will be used to get the items
        // from the next page.

  loader    : "{{ STATIC_URL }}img/loader.gif"
        // Enter the url to the loader image. This image
        // will be displayed when the next page with items
        // is loaded via AJAX.
});    
</script>
{% endblock %}

{% block content %}
<form>
    <button type="button" name="" value="" class="css3button" onclick="document.location.href='{% url add_event %}'">Создать соревнование</button>
</form>
<div class="event_list">
    {% for event_days, imonth, iyear in months_events %}
    <div class="month_events">
        <div class="grid_9">
            {% for day_events in event_days %}
                <h3 style="color:#990000;">
                    <a class="anchor" name="{{ day_events.date|urlencode }}" href="#{{ day_events.date|urlencode }}">§</a>
                    {{ day_events.date|ru_strftime:"%d %B" }}
                </h3>
                {% for event in day_events.events %}
                    <div class="event">
                        <div>
                            <h4 class="place">{{ event.place }}</h4>
                        </div>
                        <div>
                            <h5><a href="{% url event event.id %}">{{ event.name }}</a></h5>
                        </div>
                        
                        <ul class="comp_list">
                            {% for comp in event.competitions.all %}
                                <li>
                                    {% if comp.processed %}
                                        <a href="{% url protocol comp.id %}">{{ comp }}</a>
                                    {% else %}
                                        {{ comp }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>

                        <div>
                            {% if event.protocol_file %}
                                <img src="{{ STATIC_URL }}img/download.png"><a href="{{ event.protocol_file.url }}">Скачать протокол</a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
        <div class="grid_3">
            {% gencal event_days iyear imonth%}
        </div>
    </div>
    {% endfor %}
    {% if next_events_exists %}
    <div class="navigation">
            <div class="next-events">
                <a href="/calendar/{{ next_year }}-{{ next_month }}">Следующие</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
